<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta content="{{ csrf_token() }}" name="csrf-token" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>suez</title>
    <link rel="stylesheet" href="/static/assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/assets/css/Navigation-with-Button.css">
    <link rel="stylesheet" href="/static/assets/css/styles.css">
    <script src="/static/assets/js/jquery.min.js"></script>
    <script src="/static/assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
    <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css">


</head>

<body>
<div>
    <nav class="navbar navbar-default navigation-clean-button">
        <div class="container">
            <div class="navbar-header"><a class="navbar-brand" href="#">Company Name</a>
                <button class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navcol-1"><span
                        class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span
                        class="icon-bar"></span><span class="icon-bar"></span></button>
            </div>
            <div
                    class="collapse navbar-collapse" id="navcol-1">
                <ul class="nav navbar-nav"></ul>
                <button class="btn btn-success navbar-btn" type="button" id="add" data-toggle="modal"
                        data-target="#main_modal">ADD
                </button>
                <button class="btn btn-warning navbar-btn" type="button" disabled="disabled" id="modify"
                        data-toggle="modal"
                        data-target="#main_modal">MODIFY
                </button>
                <button class="btn btn-danger navbar-btn" type="button" disabled="disabled" id="delete"
                        data-toggle="modal" data-target="#modal1">DELETE
                </button>
            </div>
        </div>
    </nav>
</div>
<div class="container">


    <style>
    td.details-control {
        background: url('../static/img/details_open.png') no-repeat center center;
        cursor: pointer;
    }
    tr.shown td.details-control {
        background: url('../static/img/details_close.png') no-repeat center center;
    }



    </style>


    <style>
    td.details-control {
        background: url('../static/img/details_open.png') no-repeat center center;
        cursor: pointer;
    }
    tr.shown td.details-control {
        background: url('../static/img/details_close.png') no-repeat center center;
    }



    </style>

    <table id="example" class="display" style="width:100%">
        <thead>
        <tr>
            {% for row in headers %}
            <th>{{row}}</th>
            {%endfor%}


        </tr>
        </thead>
        <tbody>

        <tr>
            <td>Tiger Nixon</td>

            <td>Tiger Nixon</td>
            <td>System Architect</td>
            <td>Edinburgh</td>
            <td>61</td>
            <td>2011/04/25</td>
            <td>$320,800</td>
        </tr>

        </tbody>
        <tfoot>
        <tr>
            {% for row in headers %}
            <th>{{row}}</th>
            {%endfor%}
        </tr>
        </tfoot>
    </table>
</div>


<div class="modal fade" role="dialog" tabindex="-1" id="main_modal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">Ã—</span></button>
                <h4 class="modal-title">PROJECT INFORMATION</h4>
            </div>
            <div class="modal-body">
                <p>Please fill out the information bellow.</p>
                <form method="post">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>

                    <div class="form-group">
                        <div class="text-center"><label class="control-label">Project Title</label></div>
                    </div>
                    <div class="form-group">
                        <div class="text-center"><input class="form-control" type="text" name="project_title" id="project_title"></div>
                    </div>
                    <div class="form-group">
                        <div class="text-center"><label class="control-label">2019</label></div>
                    </div>
                    <div class="form-group">
                        <div class="text-center"><input class="form-control" type="number" name="year_1" id="year_1"></div>
                    </div>
                    <div class="form-group">
                        <div class="text-center"><label class="control-label">2020</label></div>
                    </div>
                    <div class="form-group">
                        <div class="text-center"><input class="form-control" type="number" name="year_2" id="year_2"></div>
                    </div>
                    <div class="form-group">
                        <div class="text-center"><label class="control-label">2021</label></div>
                    </div>
                    <div class="form-group">
                        <div class="text-center"><input class="form-control" type="number" name="year_3" id="year_3"></div>
                    </div>
                    <div class="form-group">
                        <div class="text-center"><label class="control-label">2022</label></div>
                    </div>
                    <div class="form-group">
                        <div class="text-center"><input class="form-control" type="number" name="year_4" id="year_4"></div>
                    </div>
                    <div class="form-group">
                        <div class="text-center"><label class="control-label">2023</label></div>
                    </div>
                    <div class="form-group">
                        <div class="text-center"><input class="form-control" type="number" name="year_5" id="year_5"></div>
                    </div>
                    <div class="form-group">
                        <div class="text-center"><label class="control-label">Justification</label></div>
                    </div>
                    <div class="form-group">
                        <div class="text-center"><textarea class="form-control input-lg" name="justification" id="justification"></textarea></div>
                    </div>
                    <div class="form-group">
                        <div class="text-center"><label class="control-label">Comments</label></div>
                    </div>
                    <div class="form-group">
                        <div class="text-center"><textarea class="form-control input-lg" wrap="hard" name="comments" id="comments"></textarea></div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-default" type="button" data-dismiss="modal">Close</button>
                        <button class="btn btn-primary" type="submit">Submit</button>
                    </div>
                </form>
            </div>

        </div>
    </div>
</div>

<!-- <script src="https://code.jquery.com/jquery-3.3.1.js" type="text/javascript"></script> -->

<script type="text/javascript">


$(document).ready(function() {
    table = $('#example').DataTable({
            "ajax":{

            "url": "/get_data",
            "dataSrc" :"items"}
    });


var csrftoken = $('meta[name=csrf-token]').attr('content')

$.ajaxSetup({
    beforeSend: function(xhr, settings) {
        if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type)) {
            xhr.setRequestHeader("X-CSRFToken", csrftoken)
            //console.log(csrftoken);
        }
    }
})

$('#example tbody').on( 'click', 'tr', function () {

//console.log('Clicking on row.');

if ( $(this).hasClass('selected') ) {
    //console.log('Unselecting');
    $(this).removeClass('selected');
    $('#add').prop('disabled', false);
    $('#modify').prop('disabled', true);
    $('#delete').prop('disabled', true);
   
    var myURL = document.location.origin;
    var new_url = myURL.substring(0, myURL.indexOf('?'));
    window.history.pushState("object or string", "Title", myURL );

}
else {
    // this line unselects the previous one. Find a way to take care of them.
    table.$('tr.selected').removeClass('selected');
    console.log('Selecting');
    $(this).addClass('selected');
    var myURL = document.location.origin;
    var new_url = myURL.substring(0, myURL.indexOf('?'));
    window.history.pushState("object or string", "Title", myURL );
    $('#add').prop('disabled', false); /// true
    $('#modify').prop('disabled', false);
    $('#delete').prop('disabled', false);
    id = table.row('.selected').data()[0];

    var myURL = document.location;
    var new_url = myURL + "?project_id="+id;
    window.history.pushState("object or string", "Title", new_url );

    row_data = table.row('.selected').data();
    console.log(row_data);
    document.getElementById("project_title").value = row_data[1];
    document.getElementById("year_1").value = row_data[2];
    document.getElementById("year_2").value = row_data[3];
    document.getElementById("year_3").value = row_data[4];
    document.getElementById("year_4").value = row_data[5];
    document.getElementById("year_5").value = row_data[6];
    document.getElementById("justification").value = row_data[7];
    document.getElementById("comments").value = row_data[8];
}
});




$('#delete').click( function () {

    id = table.row('.selected').data()[0];
    console.log(id);
    var choice = window.confirm("Are you sure you want to delete this item?");
    var myURL = document.location.origin;
    var new_url = myURL.substring(0, myURL.indexOf('?'));

    if (choice==true){
        table.row('.selected').remove().draw( false );

        $.ajax({
        type: 'DELETE',
        url: new_url + "/delete_data/"+id,
        data:{"deleting":id},
        success: function(data){
            table.row('.selected').remove().draw( false );
            //document.getElementById("add_item").disabled = false;
            //document.getElementById("edit_item").disabled = true;
            //document.getElementById("delete_row").disabled = true;

        },
        error: function (xhr, statusText, err) {
          alert("error"+xhr.status);
        }
    });}

    else{}


});














} );





</script>

</body>

</html>